---
title: "p8105_hw5"
author: "Divya Bisht"
date: "11/5/2018"
output: github_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

library(tidyverse)
library(rvest)
library(broom)
```

#Problem 1
```{r}

df_long_study = str_c("./data/", list.files(path = "./data"))


long_study = 
  tibble(df_long_study) %>% 
  mutate(data = map(df_long_study, read_csv)) %>% 
  unnest()

control = long_study %>% 
  filter(str_detect(df_long_study, "./data/con")) %>%
  mutate(subject_id = row_number(), subject_id = as.character(subject_id), subject_id = str_c(subject_id, "_control")) %>%
  
experimental = long_study %>% 
  filter(str_detect(df_long_study, "./data/exp")) %>%
  mutate(subject_id = row_number(), subject_id = as.character(subject_id), subject_id = str_c(subject_id, "_exp")) %>% 

all_cases = 
  rbind(control, experimental) %>% 
  select(-df_long_study) %>%
  separate(subject_id, into = c("subject_id", "arm"), sep = "_") %>% 
  mutate(subject_id = as.character(subject_id)) %>% 
  gather(key = week, value = obs, week_1:week_8) %>% 
  mutate(week = str_sub(week, start = 6, end = 6), 
         week = as.numeric(week)) 

```

```{r}
all_cases %>% 
  ggplot(aes(x = week, y = obs, color = subject_id)) + 
  geom_line() +
  
  facet_grid(~arm)
```
There are more observations in the experimental arm than in the control arm over the weeks of the study. 




#Problem 2 
Importing the CSV
```{r}
homicides = read_csv("./data-homicides-master/homicide-data.csv") %>% 
  janitor::clean_names()
```

The data has 12 columns and 52179 rows. The columns/variables include: dates of homicide and information about the victim like their 's name, race, age. Additional variables include the city/state that the homicide occurred accompanied with latitude and longitude data. Finally, the dataset includes the disposition information, which describes if the case is closed with or without arrest. nn  

```{r}
homicides = homicides %>%
  unite(city, state, col = "city_state", sep = ", ")
```

summarize within cities to obtain the total number of homicides and the number of unsolved homicides (those for which the disposition is “Closed without arrest” or “Open/No arrest”).

Number of homicides within cities:
```{r}
city = homicides %>% 
  group_by(city_state) %>% 
  summarize(total = n())
```

Number of unsolved homicides within cities:
```{r}
unsolved = homicides %>% 
  filter(disposition == "Closed without arrest" | disposition == "Open/No arrest") %>% 
  group_by(city_state) %>%
  summarize(unsolved = n())
```

```{r}
homicide_table = 
  merge(city, unsolved) %>% 
  filter(city_state == "Baltimore, MD")
```

Save prop.test as an object: 
```{r}
prop_test = 
  prop.test(homicide_table$unsolved, homicide_table$total)


  broom::tidy(prop_test) %>% 
  select(estimate, conf.low, conf.high)
  
```


```{r}

```

FUNCTION!?
```{r}
output = homicide_table %>% 
  mutate(proportion = map2(.x = unsolved, .y = total, ~prop.test(x = .x, n = .y)))
```






